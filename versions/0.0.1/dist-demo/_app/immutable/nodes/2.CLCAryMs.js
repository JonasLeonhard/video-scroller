import{y as A,s as G,z as I,n as T,r as Z,b as x,o as $,e as C,f as ee}from"../chunks/scheduler.L35_OEEf.js";import{y as q,z as te,S as J,i as K,e as k,s as D,c as H,d as S,g as h,h as E,o as b,p as y,j as w,k as j,A as F,B as ne,m as O,t as M,q as se,a as Q,n as ie,H as oe,C as le,D as ae,E as re,u as ce,v as fe,w as de,x as me}from"../chunks/index.Bz2Dd4vm.js";import{w as ue}from"../chunks/index.BwrQVMmt.js";const he=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function z(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function B(t){return Object.prototype.toString.call(t)==="[object Date]"}function U(t,n,e,s){if(typeof e=="number"||B(e)){const a=s-e,r=(e-n)/(t.dt||1/60),m=t.opts.stiffness*a,i=t.opts.damping*r,o=(m-i)*t.inv_mass,l=(r+o)*t.dt;return Math.abs(l)<t.opts.precision&&Math.abs(a)<t.opts.precision?s:(t.settled=!1,B(e)?new Date(e.getTime()+l):e+l)}else{if(Array.isArray(e))return e.map((a,r)=>U(t,n[r],e[r],s[r]));if(typeof e=="object"){const a={};for(const r in e)a[r]=U(t,n[r],e[r],s[r]);return a}else throw new Error(`Cannot spring ${typeof e} values`)}}function pe(t,n={}){const e=ue(t),{stiffness:s=.15,damping:a=.8,precision:r=.01}=n;let m,i,o,l=t,c=t,u=1,d=0,f=!1;function g(_,v={}){c=_;const W=o={};return t==null||v.hard||p.stiffness>=1&&p.damping>=1?(f=!0,m=q(),l=_,e.set(t=c),Promise.resolve()):(v.soft&&(d=1/((v.soft===!0?.5:+v.soft)*60),u=0),i||(m=q(),f=!1,i=te(V=>{if(f)return f=!1,i=null,!1;u=Math.min(u+d,1);const P={inv_mass:u,opts:p,settled:!0,dt:(V-m)*60/1e3},X=U(P,l,t,c);return m=V,l=t,e.set(t=X),P.settled&&(i=null),!P.settled})),new Promise(V=>{i.promise.then(()=>{W===o&&V()})}))}const p={set:g,update:(_,v)=>g(_(c,t),v),subscribe:e.subscribe,stiffness:s,damping:a,precision:r};return p}function ge(t){const n=t-1;return n*n*n+1}function Y(t,{delay:n=0,duration:e=400,easing:s=ge,x:a=0,y:r=0,opacity:m=0}={}){const i=getComputedStyle(t),o=+i.opacity,l=i.transform==="none"?"":i.transform,c=o*(1-m),[u,d]=A(a),[f,g]=A(r);return{delay:n,duration:e,easing:s,css:(p,_)=>`
			transform: ${l} translate(${(1-p)*u}${d}, ${(1-p)*f}${g});
			opacity: ${o-c*_}`}}const{window:_e}=he;function L(t,n,e){const s=t.slice();return s[10]=n[e],s}function N(t){let n,e,s=t[10].html+"",a,r,m,i;return{c(){n=k("div"),e=new oe(!1),a=D(),this.h()},l(o){n=H(o,"DIV",{class:!0,style:!0});var l=S(n);e=le(l,!1),a=E(l),l.forEach(h),this.h()},h(){e.a=a,b(n,"class","unstable3d__animation-item svelte-1e66j3g"),y(n,"left",t[10].position.x),y(n,"top",t[10].position.y)},m(o,l){w(o,n,l),e.m(s,n),j(n,a),i=!0},p(o,l){t=o,(!i||l&4)&&s!==(s=t[10].html+"")&&e.p(s),(!i||l&4)&&y(n,"left",t[10].position.x),(!i||l&4)&&y(n,"top",t[10].position.y)},i(o){i||(o&&ee(()=>{i&&(m&&m.end(1),r=ae(n,Y,t[10].enter.transition.data),r.start())}),i=!0)},o(o){r&&r.invalidate(),o&&(m=re(n,Y,t[10].leave.transition.data)),i=!1},d(o){o&&h(n),o&&m&&m.end()}}}function R(t){let n,e=t[5]>=t[10].enter.time&&t[5]<=t[10].leave.time&&N(t);return{c(){e&&e.c(),n=O()},l(s){e&&e.l(s),n=O()},m(s,a){e&&e.m(s,a),w(s,n,a)},p(s,a){s[5]>=s[10].enter.time&&s[5]<=s[10].leave.time?e?(e.p(s,a),a&36&&M(e,1)):(e=N(s),e.c(),M(e,1),e.m(n.parentNode,n)):e&&(se(),Q(e,1,1,()=>{e=null}),ie())},d(s){s&&h(n),e&&e.d(s)}}}function ye(t){let n,e,s,a,r,m,i,o=z(t[2]),l=[];for(let c=0;c<o.length;c+=1)l[c]=R(L(t,o,c));return{c(){n=k("div"),e=k("div"),s=k("video"),r=D();for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){n=H(c,"DIV",{class:!0,style:!0});var u=S(n);e=H(u,"DIV",{class:!0});var d=S(e);s=H(d,"VIDEO",{class:!0,preload:!0,src:!0}),S(s).forEach(h),r=E(d);for(let f=0;f<l.length;f+=1)l[f].l(d);d.forEach(h),u.forEach(h),this.h()},h(){b(s,"class","unstable3d__video svelte-1e66j3g"),s.muted=!0,b(s,"preload","metadata"),I(s.src,a=t[0])||b(s,"src",a),b(e,"class","unstable3d__animation-layer svelte-1e66j3g"),b(n,"class","unstable3d__track svelte-1e66j3g"),y(n,"height",t[1]+"px")},m(c,u){w(c,n,u),j(n,e),j(e,s),t[8](s),j(e,r);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);t[9](n),m||(i=[F(_e,"scroll",t[7]),F(s,"loadedmetadata",t[7])],m=!0)},p(c,[u]){if(u&1&&!I(s.src,a=c[0])&&b(s,"src",a),u&36){o=z(c[2]);let d;for(d=0;d<o.length;d+=1){const f=L(c,o,d);l[d]?l[d].p(f,u):(l[d]=R(f),l[d].c(),l[d].m(e,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}u&2&&y(n,"height",c[1]+"px")},i:T,o:T,d(c){c&&h(n),t[8](null),ne(l,c),t[9](null),m=!1,Z(i)}}}function be(t,n,e){let s,{videoUrl:a}=n,{trackHeightPx:r}=n,{animations:m}=n,i,o,l=pe(0);x(t,l,f=>e(5,s=f));const c=()=>{requestAnimationFrame(async()=>{if(!o||!i||!(o!=null&&o.duration))return!1;const g=window.scrollY+i.getBoundingClientRect().top,p=(window.scrollY-g)/(i.scrollHeight-window.innerHeight),_=Math.min(Math.max(p,0),1);l.set(o.duration*_)})};$(()=>(o.readyState>2&&c(),l.subscribe(async g=>{await o.play(),e(4,o.currentTime=g,o),o.pause()})));function u(f){C[f?"unshift":"push"](()=>{o=f,e(4,o)})}function d(f){C[f?"unshift":"push"](()=>{i=f,e(3,i)})}return t.$$set=f=>{"videoUrl"in f&&e(0,a=f.videoUrl),"trackHeightPx"in f&&e(1,r=f.trackHeightPx),"animations"in f&&e(2,m=f.animations)},[a,r,m,i,o,s,l,c,u,d]}class we extends J{constructor(n){super(),K(this,n,be,ye,G,{videoUrl:0,trackHeightPx:1,animations:2})}}function ve(t){let n,e,s,a,r,m;return s=new we({props:{animations:[{enter:{time:8.2,transition:{data:{duration:500,y:-20},type:"fly"}},html:'<h1 class="my-headline">My Headline</h1>',leave:{time:14.8,transition:{data:{duration:500,y:0},type:"fly"}},position:{x:"80%",y:"50%"}},{enter:{time:3.2,transition:{data:{duration:500,y:-20},type:"fly"}},html:'<h1 class="my-headline">Another Headline</h1>',leave:{time:5,transition:{data:{duration:500,y:0},type:"fly"}},position:{x:"15%",y:"15%"}}],trackHeightPx:9600,videoUrl:"https://jonasleonhard.github.io/video-scroller/versions/0.0.1/dist-demo/scrollvideo.mp4"}}),{c(){n=k("div"),e=D(),ce(s.$$.fragment),a=D(),r=k("div"),this.h()},l(i){n=H(i,"DIV",{style:!0}),S(n).forEach(h),e=E(i),fe(s.$$.fragment,i),a=E(i),r=H(i,"DIV",{style:!0}),S(r).forEach(h),this.h()},h(){y(n,"height","800px"),y(r,"height","800px")},m(i,o){w(i,n,o),w(i,e,o),de(s,i,o),w(i,a,o),w(i,r,o),m=!0},p:T,i(i){m||(M(s.$$.fragment,i),m=!0)},o(i){Q(s.$$.fragment,i),m=!1},d(i){i&&(h(n),h(e),h(a),h(r)),me(s,i)}}}class Ve extends J{constructor(n){super(),K(this,n,null,ve,G,{})}}export{Ve as component};
